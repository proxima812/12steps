---
import { getTaxonomy } from "@/utils/getTaxonomy";
import { customSlugify } from "@/utils/libs/customSlugify";
import { getSinglePage } from "@/utils/libs/getSinglePage";
import ButtonLink from "./Customs/ButtonLink.astro";

const posts = await getSinglePage("posts");
const tags = await getTaxonomy("posts", "tags");
const tagCounts = {};
posts.forEach((post) => {
  // @ts-ignore
  post.data.tags.forEach((tag) => {
    if (!tagCounts[tag]) {
      tagCounts[tag] = 0;
    }
    tagCounts[tag]++;
  });
});

const urlFull = new URL(Astro.url.pathname, Astro.site);
---

<nav
  class="flex w-full items-center gap-3 overflow-x-scroll py-3 lg:overflow-hidden lg:py-0"
>
  <ButtonLink
    link="/posts"
    class:list={Astro.url.pathname === "/posts" 
      ? "whitespace-nowrap"
      : "whitespace-nowrap bg-white text-black hover:bg-white "}
  >
    Все посты
  </ButtonLink>
  {
    tags &&
      tags.map((tag) => (
        <ButtonLink
          class="whitespace-nowrap rounded-md ring-1 ring-inset ring-white/20 transition-colors duration-75 ease-linear hover:bg-white/20"
          link={`/tags/${customSlugify(tag)}`}
        >
          {tag} ({tagCounts[tag] || ""})
        </ButtonLink>
      ))
  }
</nav>
